# 實價登錄網站爬蟲系統的提詞 Prompt   
## 目標：   
請設計一個基於 Selenium 的實價登錄網站爬蟲系統，系統分為配置文件 [basic\_price\_house.json](vscode-file:/vscode-app/Applications/Visual%20Studio%20Code.app/Contents/Resources/app/out/vs/code/electron-sandbox/workbench/workbench.html) 和主程式 [basic\_price\_house.py](vscode-file:/vscode-app/Applications/Visual%20Studio%20Code.app/Contents/Resources/app/out/vs/code/electron-sandbox/workbench/workbench.html)，採用「配置驅動」的設計方法，使爬蟲行為可以透過配置文件進行調整而不需修改程式碼。   
## 系統架構要求：   
1. **配置驅動設計**：所有爬蟲行為（搜尋條件、XPath 選擇器、頁面解析規則等）都應從配置文件讀取   
2. **模組化結構**：程式碼應分為工具函數、配置處理、瀏覽器控制、搜尋參數處理、列表頁面處理、分頁控制、詳情頁面處理、結果處理等區塊   
3. **雙模式搜尋**：支援「表單交互」和「直接 URL 訪問」兩種搜尋方式   
4. **URL 參數式分頁**：使用 URL 參數方式進行翻頁，而不是點擊頁面元素   
5. **全流程錯誤處理**：各個環節應有適當的錯誤捕獲和處理機制   
6. **詳細日誌輸出**：程式運行時提供清晰的日誌信息，顯示當前操作和結果   
   
## 配置文件 ( basic\_price\_house.json) 結構需求：   
1. **基本信息**：網站名稱、基本 URL、編碼方式、版本等   
2. **請求參數**：User-Agent、延遲時間設置等   
3. **搜尋參數**：   
    - 縣市選擇（包含選擇器、預設值）   
    - 鄉鎮區選擇（需考慮選擇縣市後才會顯示）   
    - 建物型態選擇   
    - 搜尋按鈕和等待時間配置   
4. **列表頁配置**：   
    - 項目容器 XPath   
    - 數據欄位配置（交易日期、地址、類型、總價等）   
    - 每個欄位的 XPath 選擇器和資料類型   
5. **詳情頁配置**：   
    - URL 模式   
    - 頁面容器   
    - 詳細資料欄位（地址、建物類型、格局、屋齡等）   
6. **分頁配置**：   
    - 每頁項目數   
    - 總數獲取 XPath   
    - 最大頁數限制   
7. **進階設置**：   
    - URL 格式配置   
    - 錯誤頁面保存選項   
    - 參數編碼規則   
    - 建物類型映射表（用於 URL 構建）   
   
## 主程式 ( basic\_price\_house.py) 功能需求：   
1. **工具函數區**：   
    - 文字清理（移除多餘空白）   
    - JSON 序列化處理   
    - URL 標準化和編碼   
2. **配置處理區**：   
    - 配置檔案載入和解析   
3. **瀏覽器控制區**：   
    - WebDriver 設置   
    - 元素等待機制   
    - 安全點擊處理（處理各種點擊異常）   
4. **搜尋參數處理區**：   
    - 選擇縣市   
    - 選擇鄉鎮區   
    - 選擇建物型態   
    - 點擊搜尋按鈕   
5. **列表頁面處理區**：   
    - 獲取總記錄數   
    - 解析列表項目   
    - 提取資料欄位   
6. **分頁控制區**：   
    - 計算總頁數   
    - 生成分頁 URL   
    - 頁面切換與處理   
7. **詳情頁面處理區**：   
    - 訪問詳情頁   
    - 解析詳細資料   
    - 多頁處理邏輯   
8. **結果處理區**：   
    - 保存結果為 JSON   
    - 結果統計和報告   
    - 錯誤頁面保存   
9. **主程序區**：   
    - 流程控制   
    - 兩種搜尋模式實現   
    - 清理資源   
   
## 關鍵技術實現點：   
1. **URL 構建**：   
    - 基於配置檔案中的模式 `{base\_url}/{city}\_city/{district}\_zip/{building\_type\_param}`   
    - 參數編碼處理   
    - 建物類型的特殊映射   
2. **翻頁機制**：   
    - 使用 URL 參數方式翻頁 ( `?p=2`)   
    - 現有 URL 參數處理 (替換或新增)   
3. **安全點擊**：   
    - 實現多次嘗試的點擊機制   
    - 結合 JavaScript 執行的備用點擊   
4. **資料清理與格式化**：   
    - HTML 內容處理   
    - 文字標準化   
    - 結果序列化   
   
## 特別注意事項：   
1. 搜尋流程需先使用 `search\_parameters` 操作搜尋框，選好縣市、鄉鎮區及建物型態後，最後點擊搜尋按鈕   
2. 列表頁每頁顯示 20 筆資料，需從頁面獲取總筆數計算頁數   
3. 分頁操作不使用點擊，而是透過修改 URL 參數 ( `?p=頁碼`) 實現   
4. 詳情頁的 DOM 結構需按照配置進行解析，特別注意容器元素的定位 ( [div[@class='realprice-list-detail-content']](vscode-file:/vscode-app/Applications/Visual%20Studio%20Code.app/Contents/Resources/app/out/vs/code/electron-sandbox/workbench/workbench.html))   
5. 配置檔案的每個參數都應被程式正確讀取和應用   
6. 系統需處理各類錯誤情況，確保最大程度獲取資料   
   
請實現這個系統，同時保持代碼整潔、功能模組化、錯誤處理完善，並提供詳細的檔案結構和關鍵函數說明。   
