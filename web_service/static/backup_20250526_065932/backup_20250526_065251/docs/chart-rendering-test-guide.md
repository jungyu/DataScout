# 圖表渲染修復測試指南

## 概述
本文檔提供了對 DataScout 儀表板圖表渲染問題修復的測試指南。修復的主要目標是解決三種圖表類型（蠟燭圖、折線圖和面積圖）在渲染時的問題。

## 修復內容
1. **蠟燭圖渲染問題**
   - 問題：顯示 3 個範例但無法正確渲染
   - 修復：實現專用的 `handleCandlestickChart` 函數處理蠟燭圖數據

2. **折線圖渲染問題**
   - 問題：顯示 2 個載入的範例，但圖表在渲染後消失
   - 修復：增強 `line-chart-fix.js` 和 `line-chart-handler.js` 以確保圖表持久化

3. **面積圖渲染問題**
   - 問題：顯示 2 個載入的範例，但只渲染一個圖表
   - 修復：實現 `area-chart-handler.js` 確保正確處理多個面積圖

4. **JSON 格式化問題**
   - 問題：所有圖表類型中的 JSON formatter 函數導致解析錯誤
   - 修復：實現 `json-formatter-fix.js` 處理 JSON 中的函數字符串

## 示例數據文件
每種圖表類型都添加了至少 3 個示例：
- **蠟燭圖**：4個範例
- **折線圖**：4個範例
- **面積圖**：5個範例

## 測試方法

### 自動驗證測試
我們添加了 `chart-verification.js` 到所有圖表頁面，它會自動檢測和驗證圖表是否正確渲染。
查看瀏覽器控制台以獲取驗證結果。

### 手動測試步驟

**測試蠟燭圖：**
1. 打開 `index.html` 頁面
2. 從左側數據選擇器中選擇不同的蠟燭圖範例
3. 驗證所有範例都能成功渲染
4. 檢查圖表是否顯示正確的 OHLC 格式數據
5. 測試上傳自定義 JSON 文件功能

**測試折線圖：**
1. 打開 `line.html` 頁面
2. 從左側數據選擇器中選擇不同的折線圖範例
3. 驗證所有範例都能成功渲染
4. 檢查圖表是否在選擇新範例後仍然保持可見
5. 測試上傳自定義 JSON 文件功能

**測試面積圖：**
1. 打開 `area.html` 頁面
2. 從左側數據選擇器中選擇不同的面積圖範例
3. 驗證所有範例都能成功渲染
4. 確認選擇不同範例時，所有圖表都能正確顯示
5. 測試上傳自定義 JSON 文件功能

## 最新修復項目

1. **折線圖問題修復** 
   - 問題：載入預設資料失敗: Failed to execute 'json' on 'Response'
   - 修復：增強 JSON 解析器處理更多格式錯誤，添加 `enhanced-line-chart-handler.js` 特殊處理

2. **區域圖問題修復**
   - 問題：無法載入面積圖資料
   - 修復：更新 `area-chart-handler.js` 以嘗試多個備用資料源

3. **柱形圖問題修復**
   - 問題：無法套用未知的圖表類型: column
   - 修復：添加 `column-chart-handler.js` 專用處理器

4. **通用錯誤處理與改進**
   - 添加 `chart-error-handler.js` 提供統一的錯誤處理機制
   - 增強 `data-loader.js` 以使用文本方式載入 JSON 並進行格式修復
   - 改進 `json-formatter-fix.js` 處理更多 JSON 格式問題

## 常見問題與解決方案

1. **圖表仍無法渲染**
   - 檢查瀏覽器控制台是否有錯誤
   - 確保 `json-formatter-fix.js` 和 `chart-error-handler.js` 已正確載入
   - 確保對應的專用處理器腳本（如 `candlestick-fix.js`）已正確載入
   - 嘗試清除瀏覽器緩存後重新載入

2. **圖表在切換範例後消失**
   - 確認圖表實例在切換前已正確銷毀
   - 檢查各圖表處理器中的清理邏輯是否正常運作
   - 檢查 `data-loader.js` 中的 `clearAllChartsForType` 函數是否正確執行

3. **JSON 格式問題**
   - 查看具體錯誤訊息
   - 使用瀏覽器開發工具檢查載入的 JSON 資料格式
   - 手動修改範例文件修復格式問題
   - 更新 `json-formatter-fix.js` 中的正則表達式以匹配特定模式

## 未來改進
1. 為所有圖表類型實現專用處理器
2. 整合適當的錯誤處理和用戶通知系統
3. 改進範例切換機制，提高穩定性

## 聯絡信息
如有問題，請聯絡開發團隊：dev@datascout.example.com
